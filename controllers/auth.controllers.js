"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.loginUser=exports.validateToken=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_User=_interopRequireDefault(require("../models/User")),_bcryptjs=_interopRequireDefault(require("bcryptjs")),_logging=require("../config/logging"),_sign=_interopRequireDefault(require("../functions/sign.jwt")),NAMESPACE="Auth",validateToken=function(a,b){return(0,_logging.info)(NAMESPACE,"Token validated, user authorized"),b.status(200).json({message:"Authorized"})};exports.validateToken=validateToken;var loginUser=/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c){var d,e,f,g,h,i;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=b.body,e=d.email,f=d.password,a.prev=1,a.next=4,_User["default"].findOne({email:e,state:!0});case 4:if(g=a.sent,null!==g){a.next=7;break}return a.abrupt("return",c.status(404).json({message:"Error Not Found user"}));case 7:if(h=g.password,i=_bcryptjs["default"].compareSync(f,h),i){a.next=11;break}return a.abrupt("return",c.status(400).send({message:"Invalid information"}));case 11:(0,_sign["default"])(g,function(a,b){return a?((0,_logging.error)(NAMESPACE,"Unable to sign token: ",a),c.status(401).json({message:"Unauthorized",error:a})):b?(g.password="",c.status(200).json({message:"Auth Successful",token:b,_user:g})):void 0}),a.next=18;break;case 14:return a.prev=14,a.t0=a["catch"](1),(0,_logging.error)(NAMESPACE,a.t0.message,a.t0),a.abrupt("return",c.status(500).send({message:a.t0.message,err:a.t0}));case 18:case"end":return a.stop();}},a,null,[[1,14]])}));return function(){return a.apply(this,arguments)}}();exports.loginUser=loginUser;